name: Generate Worths

on:
  workflow_dispatch:
    inputs:
      map:
        description: 'Map includes to generate worths from'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - nerva
        - away_sites_testing
        - example
        - none

env:
  BYOND_MAJOR: "514"
  BYOND_MINOR: "1589"
  MAP_PATH: ${{ inputs.map }}

jobs:
  export-worths:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@9bb56186c3b09b4f86b1c65136769dd318469633
      - name: Setup Cache
        uses: actions/cache@ab5e6d0c87105b4c9c2047343972218f562e4319
        with:
          path: ~/BYOND-${{ env.BYOND_MAJOR }}.${{ env.BYOND_MINOR }}
          key: ${{ runner.os }}-byond-${{ env.BYOND_MAJOR }}-${{ env.BYOND_MINOR }}
      - name: Generate Worths
        run: test/generate-worths.sh
      - name: Upload JSON
        if: ${{ success() && !env.ACT }}
        uses: actions/upload-artifact@v4
        with:
          name: Worths Lists (${{ inputs.map }}) - [${{ github.repository_owner }} - ${{ github.ref_name }}]
          path: |
            objects_worth.json
            materials_worth.json
